
#  Global parameters
set Dimension                                        = 2
set Start time                                       = 0
set End time                                         = 1e6
set Use years in output instead of seconds           = true
set CFL number                                       = 0.5
set Output directory                                 = output-pore_fluid_pressure_ratio
set Pressure normalization                           = no
set Timing output frequency                          = 1

set Nonlinear solver scheme                          = single Advection, iterated Stokes
set Nonlinear solver tolerance                       = 1e-4
set Max nonlinear iterations                         = 10

subsection Solver parameters
  subsection Stokes solver parameters
    set Linear solver tolerance                      = 1e-8
    set Number of cheap Stokes solver steps          = 0
  end
end

# Gravity model
subsection Gravity model
  set Model name                                     = vertical
  subsection Vertical
    set Magnitude                                    = 9.81
  end
end

### Parameters describing the model

# Model geometry 100 * 100 km
 subsection Geometry model
   set Model name                                    = box

   subsection Box
     set X repetitions                               = 5
     set Y repetitions                               = 5
     set X extent                                    = 100e3
     set Y extent                                    = 100e3
   end
 end

# Boundary conditions & initial conditions

# Composition boundary conditions
subsection Boundary composition model
  set Fixed composition boundary indicators          = bottom, left, right
  set List of model names                            = initial composition
end

# Number and names of compositional fields
subsection Compositional fields
  set Number of fields                               = 4
  set Names of fields                                = total_strain, stickyair, crust, mantle
end

subsection Initial composition model
  set Model name                                     = function
  subsection Function
    set Variable names                               = x,y
    set Function expression = 0; if(y>=90e3,1,0); if(y>=60e3 & y<90e3,1,0); if(y<60e3,1,0)
                              
  end
end

# Temperature boundary conditions
subsection Boundary temperature model
  set Fixed temperature boundary indicators          = bottom, top
  set List of model names                            = initial temperature
end

# Initial temperature field
subsection Initial temperature model
  set Model name                                     = function
  subsection Function
    set Function expression                          = 293
  end
end

# Velocity boundary conditions
subsection Boundary velocity model

  set Prescribed velocity boundary indicators        = left x:function, right x:function, bottom y:function
    subsection Function
      set Variable names                             = x,y
      set Function expression                        = if(x<50e3, 0.02, -0.02); -0.015
   end
end

subsection Boundary traction model
  set Prescribed traction boundary indicators        = top: zero traction
end

# Material properties
# Using harmonic material averaging is required to achieve reasonable
# convergence behavior, particulally when the viscosity contrast is large.
subsection Material model
  set Material averaging                             = harmonic average
  set Model name                                     = visco plastic

  subsection Visco Plastic
    set Reference temperature                        = 293
    set Reference viscosity                          = 1e22
    set Minimum viscosity                            = 1e20
    set Maximum viscosity                            = 1e24

    set Thermal diffusivities                        = 1e-6
    set Heat capacities                              = 1e3
    set Densities                                    = 3300, 1e5, 1, 2800, 3300
    set Thermal expansivities                        = 3e-5
    set Viscosity averaging scheme                   = harmonic
    set Viscous flow law                             = dislocation

    set Prefactors for dislocation creep             = 5e-20, 5e-15, 5e-15, 5e-25, 5e-20
    set Stress exponents for dislocation creep       = 1
    set Activation energies for dislocation creep    = 0
    set Activation volumes for dislocation creep     = 0

    set Angles of internal friction                  = 30, 0, 0, 30, 30
    set Cohesions                                    = 40e6, 40e6, 1e6, 20e6, 40e6
    
    set Pore fluid pressure ratios                   = 0, 0, 0.4, 0.8, 0.5 

    set Strain weakening mechanism                   = plastic weakening with total strain only
    set Start plasticity strain weakening intervals  = 0.05
    set End plasticity strain weakening intervals    = 0.2
    set Cohesion strain weakening factors            = 1 #, 1, 1, 0.4, 1
    set Friction strain weakening factors            = 1 #, 1, 1, 0.4, 1
    # Sediments and seamounts are linearly weakened by increasing the pore fluid pressure ratio
    # (i.e., inreasing fluid pressure) when the total strain increases from 0.05 to 0.2.
    # Here, when the total strain in the 'crust' is >=1, lambda increases to 0.8*2=1.6
    set Pore fluid pressure ratio strain weakening factors = 1, 1, 1, 2, 1

  end
end

# Post processing
subsection Postprocess
  set List of postprocessors                         = velocity statistics, basic statistics, temperature statistics, visualization
  subsection Visualization
    set List of output variables                     = density, viscosity, strain rate, named additional outputs
    set Output format                                = vtu
    set Time between graphical output                = 5e4
    set Interpolate output                           = true
    set Number of grouped files                      = 1
  end
end
